{
  globals,
  inputs,
  overlays,
  imports,
  ...
}:
inputs.nixpkgs.lib.nixosSystem rec {
  system = "x86_64-linux";
  specialArgs = {
    inherit inputs;
    upkgs = import inputs.nixpkgs-unstable {
      inherit system overlays;
      config = {
        allowUnfree = true;
        #allowBroken = true;
      };
    };
  };
  modules = let pkgs = specialArgs.upkgs; in [
    inputs.home-manager.nixosModules.home-manager
    ./modules/common
    ./modules/nixos
    rec {
      environment = {
        systemPackages = builtins.attrValues {
        inherit (pkgs);
        inherit (pkgs.jetbrains);
        };
        variables = {
          EDITOR = "emacs";
          VISUAL = "emacs";
        };
      };
      system.stateVersion = "25.05";
      home-manager.backupFileExtension = "backup";
      nix.settings.experimental-features = "flakes nix-command";
      nixpkgs.overlays = overlays;
      nixpkgs.config.allowUnfree = true;
      networking.hostName = "minksdWSL";
      networking.useNetworkd = true;

      virtualisation.docker.enable = true;
      virtualisation.podman.enable = true;


      systemd.network = {
        enable = true;
        wait-online.anyInterface = true;
        networks = {
          "01-enp111s0" = {
            enable = true;
            matchConfig.Name = "enp111s0";
            linkConfig.RequiredForOnline = "carrier";
          };
        };
      };

      time.timeZone = "America/New_York";

      i18n.defaultLocale = "en_US.UTF-8";

      fonts.packages = builtins.attrValues {
        inherit (pkgs)
        cascadia-code
          ipaexfont;
        inherit (pkgs.nerd-fonts)
        "m+";
      };

      gui.enable = true;

      desktop.niri.enable = true;
      waybar.enable = true;
      foot.enable = true;
      zsh.enable = true;
      emacs.enable = true;
      firefox.enable = true;
      discord.enable = true;
      zoom.enable = true;
      elixir.enable = true;
      xterm.enable = true;
      flatpak.enable = true;
      teams.enable = true;
      steam.enable = true;
      lutris.enable = true;
      rust.enable = true;
      minecraft.enable = true;
        }
  ];
}
