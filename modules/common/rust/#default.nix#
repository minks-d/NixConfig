{config,inputs,upkgs,lib,...}:
{
  options = {
    rust = {
      enable = lib.mkEnableOption {
        description = "Setup rust and its components.";
        default = false;
      };
    };
  };

  config = lib.mkIf (config.rust.enable) {
    environment.systemPackages = with upkgs; [
      emacsPackages.rustic
      emacsPackages.cargo
      emacsPackages.flycheck-rust
      emacsPackages.toml-mode

      rust-analyzer-nightly
      
    ];

    home-manager.users.${config.user} = {
      home.file.".emacs.d/rust.el".source = ./rust.el;
    };
  };
      

}
